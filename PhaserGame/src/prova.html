<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.2/dist/phaser-arcade-physics.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
            background-color: black;
        }
    </style>
</head>
<body>

    <script type="text/javascript">
        var config = {
        type: Phaser.AUTO,
        width: 1200,
        height: 550,
        
        physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: true
        }
    },
   
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    let game = new Phaser.Game(config);
    let Bars ;
    let Scale;
    //let Barili ;
    
    let Scala_up = false;
    let Barili_list = [];
    //let barileAlive = true;
    //let x = 900;
    //let y = 150;
    //let velocity =  - 150;
    
    
    
    function preload () 
        {
            this.load.image('background', '../img/back_donkey.png');
            this.load.image('Bar', '../img2/Bar.png');
            this.load.image('Scala', '../img2/Scala.png');
            
            //########################## Spritesheet #################### #
        // Barili
            this.load.spritesheet('Roll_on',
            '../img2/Barili.png',
            {frameWidth:29, frameHeight:30});
        }
       
    function create ()
        {this.add.image(400, 300, 'background');
        
        
        Scale = this.physics.add.staticGroup();
        
        Scale.create(910,480, );
        Scale.create(140,358, );
        Scale.create(1000,236, );
        Scale.create(500,236, );
        Scale.create(140,114, );
        //Scale.body.setSize(1, 1);
        Scale.children.iterate(function(scala) {
        scala.body.setSize(20, 80);
        scala.body.updateFromGameObject(); // aggiorna il body statico
        });

        Bars = this.physics.add.staticGroup();
        
        //for (let i = 0;i<12;i++){
        //    Bars.create((62 + (118 * i)), 542, 'Bar');
        //}
        Bars.create((62 + (118 * 0)), 542, 'Bar');
        Bars.create((62 + (118 * 1)), 542, 'Bar');
        Bars.create((62 + (118 * 2)), 542, 'Bar');
        Bars.create((62 + (118 * 3)), 542, 'Bar');
        Bars.create((62 + (118 * 4)), 542, 'Bar');
        Bars.create((62 + (118 * 5)), 542, 'Bar');
        Bars.create((62 + (118 * 6)), 542, 'Bar');
        Bars.create((62 + (118 * 7)), 542, 'Bar');
        Bars.create((62 + (118 * 8)), 542, 'Bar');
        Bars.create((62 + (118 * 9)), 542, 'Bar');
        Bars.create((62 + (118 * 10)), 542, 'Bar');

        //for (let i = 0;i<12;i++){
        //    Bars.create((62 + (118 * i)), 420, 'Bar');
        //}
        Bars.create((62 + (118 * 0)), 420, 'Bar');
        Bars.create((62 + (118 * 1)), 420, 'Bar');
        Bars.create((62 + (118 * 2)), 420, 'Bar');
        Bars.create((62 + (118 * 3)), 420, 'Bar');
        Bars.create((62 + (118 * 4)), 420, 'Bar');
        Bars.create((62 + (118 * 5)), 420, 'Bar');
        Bars.create((62 + (118 * 6)), 420, 'Bar');
        Bars.create((0 + (118 * 7)), 420, 'Bar');
        Bars.create((62 + (118 * 8)), 420, 'Bar');
        Bars.create((62 + (118 * 9)), 420, 'Bar');
        Bars.create((62 + (118 * 10)), 420, 'Bar');
        //for (let i = 0;i<12;i++){
        //    Bars.create((62 + (118 * i)), 298, 'Bar');
        //}
        Bars.create((62 + (118 * 0)), 298, 'Bar');
        Bars.create((122 + (118 * 1)), 298, 'Bar');
        Bars.create((62 + (118 * 2)), 298, 'Bar');
        Bars.create((62 + (118 * 3)), 298, 'Bar');
        Bars.create((62 + (118 * 4)), 298, 'Bar');
        Bars.create((62 + (118 * 5)), 298, 'Bar');
        Bars.create((62 + (118 * 6)), 298, 'Bar');
        Bars.create((62 + (118 * 7)), 298, 'Bar');
        Bars.create((62 + (118 * 8)), 298, 'Bar');
        Bars.create((62 + (118 * 9)), 298, 'Bar');
        Bars.create((62 + (118 * 10)), 298, 'Bar');
        //for (let i = 0;i<12;i++){
        //    Bars.create((62 + (118 * i)), 176, 'Bar');
        //}
        Bars.create((62 + (118 * 0)), 176, 'Bar');
        Bars.create((62 + (118 * 1)), 176, 'Bar');
        Bars.create((62 + (118 * 2)), 176, 'Bar');
        Bars.create((62 + (118 * 3)), 176, 'Bar');
        Bars.create((122 + (118 * 4)), 176, 'Bar');
        Bars.create((62 + (118 * 5)), 176, 'Bar');
        Bars.create((62 + (118 * 6)), 176, 'Bar');
        Bars.create((62 + (118 * 7)), 176, 'Bar');
        Bars.create((62 + (118 * 8)), 176, 'Bar');
        Bars.create((62 + (118 * 9)), 176, 'Bar');
        Bars.create((62 + (118 * 10)), 176, 'Bar');
        /////////77/////////////////////////////////////////////////////////////////////
        Bars.create(62, 60, 'Bar');
        Bars.create(562, 60, 'Bar');
        Bars.create(680, 60, 'Bar');
        Bars.create(982, 128, 'Bar');
        Bars.create(1149, 128, 'Bar');
        

     
        //############################################### BARILI OOP#####################################
        class Barili {
            
            constructor (scene,x ,y,spritesheet ,velocity){
                this.scene= scene;
                this.x = x;
                this.y = y;
                this.spritesheet = spritesheet;
                this.velocity = velocity;
                this.barileAlive = true;

                // sto creando il costruttore dove ci stanno tutte queste implementazioni 
                // lo sprite é la parte fisica del personaggio in generale 
                // probabilmente é il quadrato che determila ma parte fisica 
                this.sprite = this.scene.physics.add.sprite(this.x,this.y,this.spritesheet);
                this.sprite.setBounce(0.2);
                this.sprite.setCollideWorldBounds(true);
                this.sprite.setVelocityX(this.velocity);
        

                // questa é la parte visiva dello sprite , come l´immagine e i frame che ne compongono il design 
                this.scene.anims.create({
                key: 'barile_rotola', // nome dell'animazione
                frames: this.scene.anims.generateFrameNumbers(this.spritesheet , { start: 0, end: 3 }), // usa il nome dello spritesheet
                frameRate: 10,
                repeat: -1 // -1 = loop infinito
                })
                this.sprite.play('barile_rotola');
                this.scene.physics.add.collider(this.sprite, Bars);
            }  

        }
        for (let i = 0 ; i <4;i++){
           //let barile[i] = new Barili(this,(900/i),(150 ),'Roll_on',-150);
            Barili_list.push(new Barili(this,(900/(i+1)),(150 ),'Roll_on',-150));
        }
        //########################### Problema del momento 
        // ho un  problema con il booleano a cui non riesco ad associarlo bene e mi crea problemi per quanto riguarda il suo utilizzo 
        // forse devo provare a vedere in pygame come ho fatto !!!!!!!!!!!!!!!!!!!!!!!!!!!

        /*for (let i = 0 ; i < Barili_list.length; i ++){
                    //if (Barili_list[i].barileAlive){####################anche se l´ho tolto comunque funziona 
                    if (3<5){
                        Barili_list[i].sprite.play('barile_rotola');
                        Barili_list[i].scene.physics.add.collider(barileAlive[i].sprite, Bars);
                        console.log("funziona");
                    }
                }
                */
        //console.log(Barili_list.length);
        //barile1 = new Barili(this,900,150,'Roll_on',-150);
        
        
        //barile1.play(barile1.spritesheet);
        //this.physics.add.collider(barile1, Bars);
        //barile1 = this.physics.add.sprite(barile1.x, barile1.y, barile1.spritesheet);
        //barile1.setBounce(0.2);
        //barile1.setCollideWorldBounds(true);
        //barile1.setVelocityX(barile1.velocity);


       //if (barileAlive){
        //Barili = this.physics.add.sprite(x, y, 'Roll_on');
        //Barili.setBounce(0.2);
        //Barili.setCollideWorldBounds(true);
        //Barili.setVelocityX(velocity);
        

        //this.anims.create({
        //    key: 'barile_rotola', // nome dell'animazione
        //    frames: this.anims.generateFrameNumbers('Roll_on', { start: 0, end: 3 }), // usa il nome dello spritesheet
        //    frameRate: 10,
        //    repeat: -1 // -1 = loop infinito
        //});
       
        
        // avvia animazione
       
        //barile1.play('barile_rotola');
        
        //Barili.play('barile_rotola');
        //this.physics.add.collider(barile1, Bars);

       //}
       
 //######################### CHIAMATA DELLA COLLISIONE PER FAR STARE IL PERSONAGGIO SUL TERRENO ####################
       
      
        //function Scala_in(player,Scale){
        //    Scala_up = true;
        //    player.body.allowGravity = false;
        //    player.setVelocityY(0); // ferma la caduta
        //}

        //if (Scala_up && !player.body.touching.none && !player.body.embedded) {
        //    Scala_up = false;
        //    player.body.allowGravity = true;
        // funzione per la caduta del barile 
        //function Scala_in(Barili,Scale){

        //    Barili.setVelocityX(- velocity);
        //}
        
    
    }
        
//http://127.0.0.1:3000/PhaserGame/src/prova.html
      
    function update ()
     { for (let i = 0; i < Barili_list.length;i++){
        //if (Barili_list[i].barileAlive){
            if (Barili_list[i].sprite.x <= 20 && Barili_list[i].velocity < 0 || (Barili_list[i].sprite.x > 1185 && Barili_list[i].velocity > 0)) {
                Barili_list[i].velocity =   - Barili_list[i].velocity;
                Barili_list[i].sprite.setVelocityX(Barili_list[i].velocity);
                //console.log("ci siamo ");
            }
            if ( Barili_list[i].sprite.body.blocked.down ){
            Barili_list[i].sprite.setVelocityX(Barili_list[i].velocity);
            }// x 18  y 517
            if (Barili_list[i].sprite.x == 18 && Barili_list[i].sprite.y == 517){
                Barili_list[i].barileAlive = false;
                console.log("ci siamo ");
                //barile1.x =900;
                //barile1.y = 150;}
            //    }
            }
            }
        //console.log("velocity = "+ Barili_list[0].sprite.x);
        // console.log(Barili_list[1]);
   }
        
       /*  
           
       
    
       
       
       
       
       
       */
            
        //else if {
        //    velocity = - velocity
        //    Barili.setVelocityX(velocity);
        //}   
       
        
            //console.log("ci siamo ")
            //Barili.setVelocityX (velocity);

        //    velocity == 0;
        //    Barili.setVelocityX(velocity);
        
     //}
      
        
       
            
     
     
    
    </script>

</body>
</html>